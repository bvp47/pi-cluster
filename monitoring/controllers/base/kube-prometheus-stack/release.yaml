apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: kube-prometheus-stack
    namespace: monitoring
spec:
    interval: 30m
    chart:
        spec:
            chart: kube-prometheus-stack
            version: 66.2.2
            sourceRef:
                kind: HelmRepository
                name: kube-prometheus-stack
                namespace: monitoring
            interval: 12h
    install:
        crds: Create
    upgrade:
        crds: CreateReplace
    driftDetection:
        mode: enabled
        ignore:
            - paths:
                - /metadata/annotations/prometheus-operator-validated
              target:
                kind: PrometheusRule
    values:
        grafana:
            adminPassword: ENC[AES256_GCM,data:bj+xL4ucdDrSRV8ibkY=,iv:eaOHrhFergzw+KXAemDzfgMaQ5jaepgn/+5MkHzfY0I=,tag:LmOzrV5d8IGvjW79oOBw6g==,type:str]
            ingress:
                enabled: true
                ingressClassName: traefik
                hosts:
                    - grafana.alexsantiago.net
sops:
    age:
        - recipient: age1f8wxuw4c8v0u25x2fld7ldqmqtw5jkcjm78jltgu050eqyt3sp8s5z5shx
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBRYml0b3NzRlM4Tld6REU1
            L0c3eSt3SkE3TkNYMzRlRDJPQ1ZvaC9hSlVjCkNKSnoyQ3d0Nm12bGxtUzA2Q3hJ
            ZGw4TTNDaGt1MmJKV093aFdCd21IZ0kKLS0tIDVHYXVGd1BpVVJzdjdkSjN2VjU5
            c0lTSlc0bDhGZjhWN2hJdDNVb3pPL0EKMtlO2OXIsOjMi956qK9g+IwmCqRuy7ZW
            SFK3EkVRFutxit743ssvtnUvci8P6zJUBTF4/IueRk/XU1DQuxoxvA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-08-15T02:00:49Z"
    mac: ENC[AES256_GCM,data:x7tV6u6rOinB9hgUbhsnJ8i60T/SUowt8XBE0BsY9eyW2XTZXNvHcxQynsA38PH1rnPCpdhl/B7ywogEll7wVl2qpz7Gn+S9yuU58r1vaoHAg6C4RHfppKuV9nWjrk0R2yzvtA1w09dg5Ahss0rnJ5gnXWft1qxqC/UEjV3/TPA=,iv:9ortaGUNJmOBoP+mfON5VTSyeNAo4T+arglGkv55msk=,tag:kQEQlBxhTzuOI7EvPnOjzg==,type:str]
    encrypted_regex: ^(.*password|.*Password)$
    version: 3.10.2
